--========================================================--
--                 ToriH UI Framework
--             Created by: Hothiptvn (VN)
--         Modified by ChatGPT â€“ Startup Hidden Tab
--========================================================--

local ToriH = {}
ToriH.__index = ToriH

-- Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")

--========================================================--
--                  MAIN UI WINDOW
--========================================================--

function ToriH:CreateWindow(Info)
    Info = Info or {}

    local window = {}
    setmetatable(window, ToriH)

    window.Title = Info.Title or "ToriH UI | by Hothiptvn"
    window.ConfigFolder = Info.ConfigFolder or "ToriH_Configs"
    window.ThemeColor = Info.ThemeColor or Color3.fromRGB(80,120,255)

    if not isfolder(window.ConfigFolder) then
        makefolder(window.ConfigFolder)
    end

    -- UI Instances
    local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
    ScreenGui.Name = "ToriH_UI"

    local Frame = Instance.new("Frame", ScreenGui)
    Frame.Size = UDim2.new(0, 480, 0, 320)
    Frame.Position = UDim2.new(0.5, -240, 0.5, -160)
    Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    Frame.Active = true
    Frame.Draggable = true

    local UICorner = Instance.new("UICorner", Frame)
    UICorner.CornerRadius = UDim.new(0, 7)

    local Title = Instance.new("TextLabel", Frame)
    Title.Size = UDim2.new(1, 0, 0, 30)
    Title.Text = window.Title
    Title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    Title.TextColor3 = Color3.new(1,1,1)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 16

    Instance.new("UICorner", Title).CornerRadius = UDim.new(0,6)

    local Content = Instance.new("Frame", Frame)
    Content.Size = UDim2.new(1, 0, 1, -30)
    Content.Position = UDim2.new(0,0,0,30)
    Content.BackgroundTransparency = 1

    window.Frame = Frame
    window.ScreenGui = ScreenGui
    window.Content = Content

    -- Toggle Button
    local ToggleButton = Instance.new("TextButton", ScreenGui)
    ToggleButton.Size = UDim2.new(0, 60, 0, 60)
    ToggleButton.Position = UDim2.new(0, 20, 0.5, -30)
    ToggleButton.BackgroundColor3 = window.ThemeColor
    ToggleButton.Text = "Show"
    ToggleButton.TextScaled = true
    ToggleButton.Visible = false

    Instance.new("UICorner", ToggleButton).CornerRadius = UDim.new(1,0)
    window.ToggleButton = ToggleButton

    local Close = Instance.new("TextButton", Title)
    Close.Size = UDim2.new(0, 35, 0, 28)
    Close.Position = UDim2.new(1, -40, 0, 1)
    Close.Text = "X"
    Close.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
    Close.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", Close).CornerRadius = UDim.new(0,6)

    Close.MouseButton1Click:Connect(function()
        Frame.Visible = false
        ToggleButton.Visible = true
    end)

    ToggleButton.MouseButton1Click:Connect(function()
        ToggleButton.Visible = false
        Frame.Visible = true
    end)

    -- Tab store
    window.Tabs = {}

    -- Create startup hidden tab
    local startupTab = window:CreateTab("__startup")
    startupTab.Button.Visible = false
    startupTab.Page.Visible = true
    window.StartupTab = startupTab

    -- Create Settings tab after startup
    window:AddSettingsTab()

    return window
end

--========================================================--
--                    TAB SYSTEM
--========================================================--

function ToriH:CreateTab(Name)
    local Tab = {}

    local Button = Instance.new("TextButton", self.Content)
    Button.Size = UDim2.new(0, 100, 0, 28)
    Button.BackgroundColor3 = Color3.fromRGB(50,50,50)
    Button.Text = Name
    Button.TextColor3 = Color3.new(1,1,1)

    local Page = Instance.new("ScrollingFrame", self.Content)
    Page.Size = UDim2.new(1, -110, 1, -10)
    Page.Position = UDim2.new(0, 110, 0, 5)
    Page.Visible = false
    Page.ScrollBarThickness = 4
    Page.BackgroundTransparency = 1

    local Layout = Instance.new("UIListLayout", Page)
    Layout.Padding = UDim.new(0,6)
    Layout.SortOrder = Enum.SortOrder.LayoutOrder

    Tab.Button = Button
    Tab.Page = Page

    table.insert(self.Tabs, Tab)

    -- Tab switching
    Button.MouseButton1Click:Connect(function()
        -- Hide all previous pages
        for _, t in ipairs(self.Tabs) do
            t.Page.Visible = false
        end

        -- Hide startup tab forever after switching
        if self.StartupTab and self.StartupTab.Page.Visible then
            self.StartupTab.Page.Visible = false
            self.StartupTab.Button.Visible = false
        end

        Page.Visible = true
    end)

    return Tab
end

--========================================================--
--           ELEMENTS: LABEL, BUTTON, TOGGLE, INPUT
--========================================================--

function ToriH:AddLabel(Tab, Text)
    local lbl = Instance.new("TextLabel", Tab.Page)
    lbl.Size = UDim2.new(1,-10,0,25)
    lbl.Text = Text
    lbl.TextColor3 = Color3.new(1,1,1)
    lbl.BackgroundTransparency = 1
end

function ToriH:AddButton(Tab, Text, Callback)
    local btn = Instance.new("TextButton", Tab.Page)
    btn.Size = UDim2.new(1,-10,0,28)
    btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Text = Text

    Instance.new("UICorner", btn)

    btn.MouseButton1Click:Connect(function()
        if Callback then Callback() end
    end)
end

function ToriH:AddToggle(Tab, Text, Default, Callback)
    local tog = Instance.new("TextButton", Tab.Page)
    tog.Size = UDim2.new(1,-10,0,28)
    tog.BackgroundColor3 = Color3.fromRGB(60,60,60)
    tog.TextColor3 = Color3.new(1,1,1)

    local state = Default or false
    local function refresh()
        tog.Text = Text .. " : " .. (state and "ON" or "OFF")
    end
    refresh()

    Instance.new("UICorner", tog)

    tog.MouseButton1Click:Connect(function()
        state = not state
        refresh()
        if Callback then Callback(state) end
    end)
end

function ToriH:AddInput(Tab, Placeholder, Callback)
    local box = Instance.new("TextBox", Tab.Page)
    box.Size = UDim2.new(1,-10,0,28)
    box.PlaceholderText = Placeholder
    box.BackgroundColor3 = Color3.fromRGB(50,50,50)
    box.TextColor3 = Color3.new(1,1,1)

    Instance.new("UICorner", box)

    box.FocusLost:Connect(function()
        if Callback then Callback(box.Text) end
    end)
end

--========================================================--
--                     SETTINGS TAB
--========================================================--

function ToriH:AddSettingsTab()
    local tab = self:CreateTab("Settings")

    self:AddLabel(tab, "ToriH Framework by Hothiptvn")

    -- Delete UI
    self:AddButton(tab, "Delete UI", function()
        self.ScreenGui:Destroy()
    end)

    -- Color Setting
    self:AddLabel(tab, "Theme Color (RGB)")
    self:AddInput(tab, "R G B", function(text)
        local r,g,b = text:match("(%d+)%s+(%d+)%s+(%d+)")
        if r then
            local newColor = Color3.fromRGB(tonumber(r),tonumber(g),tonumber(b))
            self.ThemeColor = newColor
            self.ToggleButton.BackgroundColor3 = newColor
        end
    end)

    -- Save Config
    self:AddLabel(tab, "Save config name:")
    local configName = ""

    self:AddInput(tab, "Enter name", function(v)
        configName = v
    end)

    self:AddButton(tab, "Save Config", function()
        writefile(self.ConfigFolder.."/"..configName..".json", '{"Saved":true}')
    end)

    self:AddButton(tab, "Open Config Folder", function()
        setclipboard(self.ConfigFolder)
    end)
end

--========================================================--
--                        RETURN
--========================================================--

return ToriH
