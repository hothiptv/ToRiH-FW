--========================================================--
--                 ToriH UI Framework FIXED
--             Created by: Hothiptvn (VN)
--           Fixed & Stabilized by ChatGPT 2025
--========================================================--

local ToriH = {}
ToriH.__index = ToriH

local function GetGuiParent()
    return (gethui and gethui()) or game:FindFirstChildOfClass("CoreGui")
end

--========================================================--
--                     MAIN WINDOW
--========================================================--

function ToriH:CreateWindow(Info)
    Info = Info or {}

    local window = setmetatable({}, ToriH)

    window.Title = Info.Title or "ToriH UI | by Hothiptvn"
    window.ConfigFolder = Info.ConfigFolder or "ToriH_Configs"
    window.ThemeColor = Info.ThemeColor or Color3.fromRGB(80,120,255)

    if not isfolder(window.ConfigFolder) then
        makefolder(window.ConfigFolder)
    end

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "ToriH_UI"
    ScreenGui.Parent = GetGuiParent()
    window.ScreenGui = ScreenGui

    local Frame = Instance.new("Frame", ScreenGui)
    Frame.Size = UDim2.new(0, 480, 0, 320)
    Frame.Position = UDim2.new(0.5, -240, 0.5, -160)
    Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    Frame.Active = true
    Frame.Draggable = true
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 7)

    local Title = Instance.new("TextLabel", Frame)
    Title.Size = UDim2.new(1, 0, 0, 32)
    Title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    Title.Text = window.Title
    Title.TextColor3 = Color3.new(1,1,1)
    Title.Font = Enum.Font.GothamBlack
    Title.TextSize = 16
    Instance.new("UICorner", Title).CornerRadius = UDim.new(0, 6)

    local Content = Instance.new("Frame", Frame)
    Content.Size = UDim2.new(1, 0, 1, -32)
    Content.Position = UDim2.new(0, 0, 0, 32)
    Content.BackgroundTransparency = 1

    window.Frame = Frame
    window.Content = Content

    local Toggle = Instance.new("TextButton", ScreenGui)
    Toggle.Size = UDim2.new(0, 55, 0, 55)
    Toggle.Position = UDim2.new(0, 20, 0.5, -27)
    Toggle.BackgroundColor3 = window.ThemeColor
    Toggle.Text = "Show"
    Toggle.Visible = false
    Instance.new("UICorner", Toggle).CornerRadius = UDim.new(1,0)
    window.ToggleButton = Toggle

    local Close = Instance.new("TextButton", Title)
    Close.Size = UDim2.new(0, 35, 0, 28)
    Close.Position = UDim2.new(1, -40, 0, 2)
    Close.Text = "X"
    Close.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
    Close.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", Close).CornerRadius = UDim.new(0, 6)

    Close.MouseButton1Click:Connect(function()
        Frame.Visible = false
        Toggle.Visible = true
    end)

    Toggle.MouseButton1Click:Connect(function()
        Toggle.Visible = false
        Frame.Visible = true
    end)

    window.Tabs = {}

    ---------------------------------------------------
    -- ðŸŸ¦ NÃšT SETTINGS Tá»° Táº O (THEO YÃŠU Cáº¦U)
    ---------------------------------------------------
    local SettingsButton = Instance.new("TextButton", Title)
    SettingsButton.Size = UDim2.new(0, 65, 0, 28)
    SettingsButton.Position = UDim2.new(1, -110, 0, 2)
    SettingsButton.BackgroundColor3 = Color3.fromRGB(80,80,80)
    SettingsButton.TextColor3 = Color3.new(1,1,1)
    SettingsButton.Text = "SET"
    Instance.new("UICorner", SettingsButton).CornerRadius = UDim.new(0, 6)

    SettingsButton.MouseButton1Click:Connect(function()
        for _, Tab in ipairs(window.Tabs) do
            Tab.Page.Visible = false
        end

        if not window.SettingsTab then
            window.SettingsTab = window:CreateTab("Settings")
            window:ApplySettings(window.SettingsTab)
        end

        window.SettingsTab.Page.Visible = true
    end)

    return window
end

--========================================================--
--             SETTINGS TAB GENERATE FUNCTION
--========================================================--

function ToriH:ApplySettings(Tab)
    self:AddLabel(Tab, "ToriH Framework by Hothiptvn")

    self:AddButton(Tab, "Delete UI", function()
        self.ScreenGui:Destroy()
    end)

    self:AddLabel(Tab, "Theme Color (R G B)")
    self:AddInput(Tab, "Example: 255 0 0", function(text)
        local r,g,b = text:match("(%d+)%s+(%d+)%s+(%d+)")
        if r then
            local color = Color3.fromRGB(r,g,b)
            self.ThemeColor = color
            self.ToggleButton.BackgroundColor3 = color
        end
    end)
end

return ToriH
