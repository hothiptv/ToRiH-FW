--========================================================--
--                 ToriH UI Framework
--             Created by: Hothiptvn (VN)
--         Modified by ChatGPT – Auto Setting Button
--========================================================--

local ToriH = {}
ToriH.__index = ToriH

-- Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

--========================================================--
--                    CREATE WINDOW
--========================================================--

function ToriH:CreateWindow(Info)
    Info = Info or {}

    local window = setmetatable({}, ToriH)

    window.Title = Info.Title or "ToriH UI | by Hothiptvn"
    window.ConfigFolder = Info.ConfigFolder or "ToriH_Configs"
    window.ThemeColor = Info.ThemeColor or Color3.fromRGB(85,120,255)

    if not isfolder(window.ConfigFolder) then
        makefolder(window.ConfigFolder)
    end

    -- Main GUI
    local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
    ScreenGui.Name = "ToriH_UI"
    window.ScreenGui = ScreenGui

    local Frame = Instance.new("Frame", ScreenGui)
    Frame.Size = UDim2.new(0,480,0,320)
    Frame.Position = UDim2.new(0.5,-240,0.5,-160)
    Frame.BackgroundColor3 = Color3.fromRGB(25,25,25)
    Frame.Active = true
    Frame.Draggable = true
    window.Frame = Frame

    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0,7)

    local Title = Instance.new("TextLabel", Frame)
    Title.Size = UDim2.new(1,0,0,30)
    Title.Text = window.Title
    Title.BackgroundColor3 = Color3.fromRGB(40,40,40)
    Title.TextColor3 = Color3.new(1,1,1)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 16

    Instance.new("UICorner", Title).CornerRadius = UDim.new(0,6)

    local Content = Instance.new("Frame", Frame)
    Content.Size = UDim2.new(1,0,1,-30)
    Content.Position = UDim2.new(0,0,0,30)
    Content.BackgroundTransparency = 1
    window.Content = Content

    --========================================================--
    --                AUTO SETTING BUTTON (TRÒN)
    --========================================================--

    local SettingBtn = Instance.new("TextButton", ScreenGui)
    SettingBtn.Size = UDim2.new(0,55,0,55)
    SettingBtn.Position = UDim2.new(0,15,0.5,-27)
    SettingBtn.BackgroundColor3 = window.ThemeColor
    SettingBtn.TextColor3 = Color3.new(1,1,1)
    SettingBtn.Text = "⚙"
    SettingBtn.TextScaled = true

    Instance.new("UICorner", SettingBtn).CornerRadius = UDim.new(1,0)

    window.SettingBtn = SettingBtn

    -- Tabs Store
    window.Tabs = {}
    window.CurrentTab = nil

    -- Create Setting tab automatically
    window:SettingTab = window:CreateTab("Settings")
    window:SettingTab.Button.Visible = false  -- Hide the button from tab bar

    window:BuildSettings(window:SettingTab)

    -- Clicking ⚙ always open setting tab
    SettingBtn.MouseButton1Click:Connect(function()
        window:ShowTab(window:SettingTab)
    end)

    return window
end

--========================================================--
--                       TAB SYSTEM
--========================================================--

function ToriH:CreateTab(Name)
    local Tab = {}

    local Button = Instance.new("TextButton", self.Content)
    Button.Size = UDim2.new(0,100,0,28)
    Button.BackgroundColor3 = Color3.fromRGB(55,55,55)
    Button.Text = Name
    Button.TextColor3 = Color3.new(1,1,1)

    local Page = Instance.new("ScrollingFrame", self.Content)
    Page.Size = UDim2.new(1,-110,1,-10)
    Page.Position = UDim2.new(0,110,0,5)
    Page.Visible = false
    Page.BackgroundTransparency = 1
    Page.ScrollBarThickness = 3

    Instance.new("UIListLayout", Page).Padding = UDim.new(0,6)

    Tab.Button = Button
    Tab.Page = Page

    table.insert(self.Tabs, Tab)

    Button.MouseButton1Click:Connect(function()
        self:ShowTab(Tab)
    end)

    return Tab
end

function ToriH:ShowTab(Tab)
    for _, t in ipairs(self.Tabs) do
        t.Page.Visible = false
    end

    Tab.Page.Visible = true
    self.CurrentTab = Tab
end

--========================================================--
--                    UI ELEMENTS
--========================================================--

function ToriH:AddLabel(Tab, Text)
    local lbl = Instance.new("TextLabel", Tab.Page)
    lbl.Size = Udim2.new(1,-10,0,25)
    lbl.BackgroundTransparency = 1
    lbl.TextColor3 = Color3.new(1,1,1)
    lbl.Text = Text
end

function ToriH:AddButton(Tab, Text, Callback)
    local btn = Instance.new("TextButton", Tab.Page)
    btn.Size = UDim2.new(1,-10,0,28)
    btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Text = Text
    Instance.new("UICorner", btn)

    btn.MouseButton1Click:Connect(function()
        if Callback then Callback() end
    end)
end

function ToriH:AddToggle(Tab, Text, Default, Callback)
    local tog = Instance.new("TextButton", Tab.Page)
    tog.Size = UDim2.new(1,-10,0,28)
    tog.BackgroundColor3 = Color3.fromRGB(60,60,60)
    tog.TextColor3 = Color3.new(1,1,1)

    local state = Default or false
    local function update()
        tog.Text = Text.." : "..(state and "ON" or "OFF")
    end
    update()

    Instance.new("UICorner", tog)

    tog.MouseButton1Click:Connect(function()
        state = not state
        update()
        if Callback then Callback(state) end
    end)
end

function ToriH:AddInput(Tab, Placeholder, Callback)
    local box = Instance.new("TextBox", Tab.Page)
    box.Size = UDim2.new(1,-10,0,28)
    box.PlaceholderText = Placeholder
    box.BackgroundColor3 = Color3.fromRGB(50,50,50)
    box.TextColor3 = Color3.new(1,1,1)

    Instance.new("UICorner", box)

    box.FocusLost:Connect(function()
        if Callback then Callback(box.Text) end
    end)
end

--========================================================--
--                   BUILD SETTINGS TAB
--========================================================--

function ToriH:BuildSettings(tab)
    self:AddLabel(tab, "⚙ ToriH Framework Settings")

    self:AddButton(tab, "Delete UI", function()
        self.ScreenGui:Destroy()
    end)

    self:AddLabel(tab, "Theme Color (RGB):")
    self:AddInput(tab, "R G B", function(text)
        local r,g,b = text:match("(%d+)%s+(%d+)%s+(%d+)")
        if r then
            local color = Color3.fromRGB(r,g,b)
            self.ThemeColor = color
            self.SettingBtn.BackgroundColor3 = color
        end
    end)
end

--========================================================--
return ToriH
