--========================================================--
--                 ToriH UI Framework FIXED
--             Created by: Hothiptvn (VN)
--           Fully Fixed & Stabilized by ChatGPT 2025
--========================================================--

local ToriH = {}
ToriH.__index = ToriH

local function GuiParent()
    return (gethui and gethui()) or game:FindFirstChildOfClass("CoreGui")
end

------------------------------------------------------------
-- CREATE WINDOW
------------------------------------------------------------
function ToriH:CreateWindow(Info)
    Info = Info or {}

    local window = setmetatable({}, ToriH)

    window.Title = Info.Title or "ToriH UI"
    window.ThemeColor = Info.ThemeColor or Color3.fromRGB(80,120,255)

    -- GUI
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "ToriH_UI"
    ScreenGui.Parent = GuiParent()
    window.ScreenGui = ScreenGui

    -- Main Frame
    local Frame = Instance.new("Frame", ScreenGui)
    Frame.Size = UDim2.new(0, 500, 0, 330)
    Frame.Position = UDim2.new(0.5, -250, 0.5, -165)
    Frame.BackgroundColor3 = Color3.fromRGB(25,25,25)
    Frame.Active = true
    Frame.Draggable = true
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0,7)

    -- Header
    local Header = Instance.new("TextLabel", Frame)
    Header.Size = UDim2.new(1,0,0,32)
    Header.BackgroundColor3 = Color3.fromRGB(40,40,40)
    Header.Text = window.Title
    Header.TextColor3 = Color3.new(1,1,1)
    Header.Font = Enum.Font.GothamBold
    Header.TextSize = 16
    Instance.new("UICorner", Header).CornerRadius = UDim.new(0,6)

    -- Content
    local Content = Instance.new("Frame", Frame)
    Content.Size = UDim2.new(1,0,1,-32)
    Content.Position = UDim2.new(0,0,0,32)
    Content.BackgroundTransparency = 1
    window.Content = Content
    window.Frame = Frame

    ------------------------------------------------------------
    -- Toggle Button (Show UI)
    ------------------------------------------------------------
    local Toggle = Instance.new("TextButton", ScreenGui)
    Toggle.Size = UDim2.new(0,55,0,55)
    Toggle.Position = UDim2.new(0,20,0.5,-27)
    Toggle.BackgroundColor3 = window.ThemeColor
    Toggle.Text = "Show"
    Toggle.Visible = false
    Instance.new("UICorner", Toggle).CornerRadius = UDim.new(1,0)
    window.ToggleButton = Toggle

    Toggle.MouseButton1Click:Connect(function()
        Toggle.Visible = false
        Frame.Visible = true
    end)

    ------------------------------------------------------------
    -- Close Button
    ------------------------------------------------------------
    local Close = Instance.new("TextButton", Header)
    Close.Size = UDim2.new(0,35,0,28)
    Close.Position = UDim2.new(1,-40,0,2)
    Close.Text = "X"
    Close.BackgroundColor3 = Color3.fromRGB(180,50,50)
    Close.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", Close).CornerRadius = UDim.new(0,6)

    Close.MouseButton1Click:Connect(function()
        Frame.Visible = false
        Toggle.Visible = true
    end)

    window.Tabs = {}

    -- AUTO CREATE SETTINGS TAB
    window:AddSettingsTab()

    return window
end

------------------------------------------------------------
-- CREATE TAB
------------------------------------------------------------
function ToriH:CreateTab(Name)
    local Tab = {}

    local Btn = Instance.new("TextButton", self.Content)
    Btn.Size = UDim2.new(0,120,0,28)
    Btn.BackgroundColor3 = Color3.fromRGB(50,50,50)
    Btn.Text = Name
    Btn.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", Btn)

    local Page = Instance.new("ScrollingFrame", self.Content)
    Page.Size = UDim2.new(1,-130,1,-5)
    Page.Position = UDim2.new(0,125,0,5)
    Page.ScrollBarThickness = 4
    Page.Visible = false
    Page.BackgroundTransparency = 1
    Instance.new("UIListLayout", Page).Padding = UDim.new(0,6)

    Tab.Button = Btn
    Tab.Page = Page

    table.insert(self.Tabs, Tab)

    Btn.MouseButton1Click:Connect(function()
        for _,T in ipairs(self.Tabs) do
            T.Page.Visible = false
        end
        Page.Visible = true
    end)

    if #self.Tabs == 1 then Page.Visible = true end

    return Tab
end

------------------------------------------------------------
-- UI ELEMENTS
------------------------------------------------------------
function ToriH:AddLabel(Tab, Text)
    local lbl = Instance.new("TextLabel", Tab.Page)
    lbl.Size = UDim2.new(1,-10,0,25)
    lbl.BackgroundTransparency = 1
    lbl.Text = Text
    lbl.TextColor3 = Color3.new(1,1,1)
end

function ToriH:AddButton(Tab, Text, Callback)
    local btn = Instance.new("TextButton", Tab.Page)
    btn.Size = UDim2.new(1,-10,0,28)
    btn.Text = Text
    btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
    btn.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", btn)
    btn.MouseButton1Click:Connect(function()
        if Callback then Callback() end
    end)
end

function ToriH:AddToggle(Tab, Text, Default, Callback)
    local tog = Instance.new("TextButton", Tab.Page)
    tog.Size = UDim2.new(1,-10,0,28)
    Instance.new("UICorner", tog)

    local state = Default or false
    local function refresh()
        tog.Text = Text.." : "..(state and "ON" or "OFF")
        tog.BackgroundColor3 = state and Color3.fromRGB(0,150,0) or Color3.fromRGB(60,60,60)
    end
    refresh()

    tog.MouseButton1Click:Connect(function()
        state = not state
        refresh()
        if Callback then Callback(state) end
    end)
end

function ToriH:AddInput(Tab, Placeholder, Callback)
    local box = Instance.new("TextBox", Tab.Page)
    box.Size = UDim2.new(1,-10,0,28)
    box.PlaceholderText = Placeholder
    box.BackgroundColor3 = Color3.fromRGB(50,50,50)
    box.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", box)
    box.FocusLost:Connect(function()
        if Callback then Callback(box.Text) end
    end)
end

------------------------------------------------------------
-- SETTINGS TAB
------------------------------------------------------------
function ToriH:AddSettingsTab()
    local tab = self:CreateTab("Settings")

    self:AddLabel(tab, "ToriH Framework (English Version)")

    -- Shutdown Script
    self:AddButton(tab, "Shutdown Script", function()
        self.ScreenGui:Destroy()
    end)

    -- Background Transparency Toggle
    self:AddToggle(tab, "Transparent Background", false, function(state)
        self.Frame.BackgroundTransparency = state and 0.6 or 0
    end)

    -- Theme
    self:AddButton(tab, "Theme: WHITE", function()
        self.Frame.BackgroundColor3 = Color3.fromRGB(235,235,235)
    end)

    self:AddButton(tab, "Theme: BLACK", function()
        self.Frame.BackgroundColor3 = Color3.fromRGB(25,25,25)
    end)
end

return ToriH
