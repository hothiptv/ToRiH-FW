--========================================================--
--                 ToriH UI Framework FIXED
--             Created by: Hothiptvn (VN)
--           Fixed & Stabilized by ChatGPT 2025
--========================================================--

local ToriH = {}
ToriH.__index = ToriH

local function GetGuiParent()
    return (gethui and gethui()) or game:FindFirstChildOfClass("CoreGui")
end

--========================================================--
--                     MAIN WINDOW
--========================================================--

function ToriH:CreateWindow(Info)
    Info = Info or {}

    local window = setmetatable({}, ToriH)

    window.Title = Info.Title or "ToriH UI | by Hothiptvn"
    window.ConfigFolder = Info.ConfigFolder or "ToriH_Configs"
    window.ThemeColor = Info.ThemeColor or Color3.fromRGB(80,120,255)

    if not isfolder(window.ConfigFolder) then
        makefolder(window.ConfigFolder)
    end

    -- ScreenGui
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "ToriH_UI"
    ScreenGui.Parent = GetGuiParent()
    window.ScreenGui = ScreenGui

    -- Main Window
    local Frame = Instance.new("Frame", ScreenGui)
    Frame.Size = UDim2.new(0, 480, 0, 320)
    Frame.Position = UDim2.new(0.5, -240, 0.5, -160)
    Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    Frame.Active = true
    Frame.Draggable = true
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 7)

    -- Header
    local Title = Instance.new("TextLabel", Frame)
    Title.Size = UDim2.new(1, 0, 0, 32)
    Title.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    Title.Text = window.Title
    Title.TextColor3 = Color3.new(1,1,1)
    Title.Font = Enum.Font.GothamBlack
    Title.TextSize = 16
    Instance.new("UICorner", Title).CornerRadius = UDim.new(0, 6)

    -- Content
    local Content = Instance.new("Frame", Frame)
    Content.Size = UDim2.new(1, 0, 1, -32)
    Content.Position = UDim2.new(0, 0, 0, 32)
    Content.BackgroundTransparency = 1

    window.Frame = Frame
    window.Content = Content

    -- Toggle Button
    local Toggle = Instance.new("TextButton", ScreenGui)
    Toggle.Size = UDim2.new(0, 55, 0, 55)
    Toggle.Position = UDim2.new(0, 20, 0.5, -27)
    Toggle.BackgroundColor3 = window.ThemeColor
    Toggle.Text = "Show"
    Toggle.Visible = false
    Instance.new("UICorner", Toggle).CornerRadius = UDim.new(1,0)
    window.ToggleButton = Toggle

    -- Close
    local Close = Instance.new("TextButton", Title)
    Close.Size = UDim2.new(0, 35, 0, 28)
    Close.Position = UDim2.new(1, -40, 0, 2)
    Close.Text = "X"
    Close.BackgroundColor3 = Color3.fromRGB(180, 50, 50)
    Close.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", Close).CornerRadius = UDim.new(0, 6)

    Close.MouseButton1Click:Connect(function()
        Frame.Visible = false
        Toggle.Visible = true
    end)

    Toggle.MouseButton1Click:Connect(function()
        Toggle.Visible = false
        Frame.Visible = true
    end)

    -- Tab storage
    window.Tabs = {}

    -- Auto create settings tab
    window:AddSettingsTab()

    return window
end

--========================================================--
--                       TAB SYSTEM
--========================================================--

function ToriH:CreateTab(Name)
    local Tab = {}

    local Button = Instance.new("TextButton", self.Content)
    Button.Size = UDim2.new(0, 110, 0, 28)
    Button.BackgroundColor3 = Color3.fromRGB(50,50,50)
    Button.TextColor3 = Color3.new(1,1,1)
    Button.Text = Name

    local Page = Instance.new("ScrollingFrame", self.Content)
    Page.Size = UDim2.new(1, -120, 1, -5)
    Page.Position = UDim2.new(0, 115, 0, 5)
    Page.BackgroundTransparency = 1
    Page.ScrollBarThickness = 4
    Page.Visible = false

    Instance.new("UIListLayout", Page).Padding = UDim.new(0, 6)

    Tab.Button = Button
    Tab.Page = Page
    table.insert(self.Tabs, Tab)

    Button.MouseButton1Click:Connect(function()
        for _, T in ipairs(self.Tabs) do
            T.Page.Visible = false
        end
        Page.Visible = true
    end)

    if #self.Tabs == 1 then
        Page.Visible = true
    end

    return Tab
end

--========================================================--
--               ELEMENTS: BUTTON/TOGGLE/LABEL
--========================================================--

function ToriH:AddLabel(Tab, Text)
    local lbl = Instance.new("TextLabel", Tab.Page)
    lbl.Size = UDim2.new(1,-10,0,25)
    lbl.BackgroundTransparency = 1
    lbl.Text = Text
    lbl.TextColor3 = Color3.new(1,1,1)
end

function ToriH:AddButton(Tab, Text, Callback)
    local btn = Instance.new("TextButton", Tab.Page)
    btn.Size = UDim2.new(1,-10,0,28)
    btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Text = Text
    Instance.new("UICorner", btn)

    btn.MouseButton1Click:Connect(function()
        if Callback then Callback() end
    end)
end

function ToriH:AddToggle(Tab, Text, Default, Callback)
    local tog = Instance.new("TextButton", Tab.Page)
    tog.Size = UDim2.new(1,-10,0,28)
    tog.BackgroundColor3 = Color3.fromRGB(60,60,60)
    tog.TextColor3 = Color3.new(1,1,1)

    local state = Default or false
    local function Refresh()
        tog.Text = Text.." : "..(state and "ON" or "OFF")
    end
    Refresh()
    Instance.new("UICorner", tog)

    tog.MouseButton1Click:Connect(function()
        state = not state
        Refresh()
        if Callback then Callback(state) end
    end)
end

function ToriH:AddInput(Tab, Placeholder, Callback)
    local box = Instance.new("TextBox", Tab.Page)
    box.Size = UDim2.new(1,-10,0,28)
    box.PlaceholderText = Placeholder
    box.BackgroundColor3 = Color3.fromRGB(50,50,50)
    box.TextColor3 = Color3.new(1,1,1)
    Instance.new("UICorner", box)

    box.FocusLost:Connect(function()
        if Callback then Callback(box.Text) end
    end)
end

--========================================================--
--                     SETTINGS TAB
--========================================================--

function ToriH:AddSettingsTab()
    local tab = self:CreateTab("Settings")

    self:AddLabel(tab, "ToriH Framework by Hothiptvn")

    self:AddButton(tab, "Delete UI", function()
        self.ScreenGui:Destroy()
    end)

    self:AddLabel(tab, "Theme Color (R G B)")
    self:AddInput(tab, "Example: 255 0 0", function(text)
        local r,g,b = text:match("(%d+)%s+(%d+)%s+(%d+)")
        if r then
            local color = Color3.fromRGB(r,g,b)
            self.ThemeColor = color
            self.ToggleButton.BackgroundColor3 = color
        end
    end)
end

return ToriH
