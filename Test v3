--====================================================================--
--                TORIH UI FRAMEWORK V3 - THE TITAN
--                DEVELOPER: NGUYỄN TRỌNG AN
--                VERSION: 3.1.0 (ULTIMATE PRESTIGE)
--====================================================================--

local ToriH = {
    Elements = {},
    Themes = {
        Default = Color3.fromRGB(0, 255, 127),
        Ruby = Color3.fromRGB(255, 60, 60),
        Ocean = Color3.fromRGB(0, 150, 255),
        Gold = Color3.fromRGB(255, 200, 0),
        Purple = Color3.fromRGB(180, 50, 255)
    },
    Flags = {},
    Signals = {}
}
ToriH.__index = ToriH

-- [[ SERVICES ]] --
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local TextService = game:GetService("TextService")
local CoreGui = (gethui and gethui()) or game:FindFirstChildOfClass("CoreGui")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- [[ ANIMATION CONFIG ]] --
local T_Info = TweenInfo.new(0.4, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)

-- [[ UTILITIES ]] --
local function Create(class, props)
    local inst = Instance.new(class)
    for i, v in pairs(props) do inst[i] = v end
    return inst
end

local function MakeDraggable(obj, dragObj)
    local dragging, dragStart, startPos
    dragObj = dragObj or obj
    dragObj.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = input.Position
            startPos = obj.Position
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - dragStart
            obj.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
end

local function Ripple(obj)
    task.spawn(function()
        local mousePos = UserInputService:GetMouseLocation()
        local objPos = obj.AbsolutePosition
        local relX, relY = mousePos.X - objPos.X, mousePos.Y - (objPos.Y + 36)
        
        local circle = Create("Frame", {
            Parent = obj, BackgroundColor3 = Color3.new(1, 1, 1),
            BackgroundTransparency = 0.8, BorderSizePixel = 0,
            Position = UDim2.new(0, relX, 0, relY), Size = UDim2.new(0, 0, 0, 0),
            ZIndex = 15, ClipsDescendants = true
        })
        Create("UICorner", {Parent = circle, CornerRadius = UDim.new(1, 0)})
        TweenService:Create(circle, TweenInfo.new(0.6), {
            Size = UDim2.new(0, 300, 0, 300),
            Position = UDim2.new(0, relX - 150, 0, relY - 150),
            BackgroundTransparency = 1
        }):Play()
        task.wait(0.6) circle:Destroy()
    end)
end

--========================================================--
--                  NOTIFICATION SYSTEM
--========================================================--
function ToriH:Notify(title, desc, duration)
    local notif = Create("Frame", {
        Parent = self.Gui, Size = UDim2.new(0, 280, 0, 85),
        Position = UDim2.new(1, 300, 1, -100), BackgroundColor3 = Color3.fromRGB(15, 15, 15),
        ZIndex = 1000, BorderSizePixel = 0
    })
    Create("UICorner", {Parent = notif, CornerRadius = UDim.new(0, 8)})
    Create("UIStroke", {Parent = notif, Color = self.ThemeColor, Thickness = 1.2})
    
    local tLbl = Create("TextLabel", {
        Parent = notif, Size = UDim2.new(1, -20, 0, 30), Position = UDim2.new(0, 12, 0, 8),
        BackgroundTransparency = 1, Text = title, TextColor3 = self.ThemeColor,
        Font = Enum.Font.GothamBold, TextSize = 15, TextXAlignment = 0
    })
    
    local dLbl = Create("TextLabel", {
        Parent = notif, Size = UDim2.new(1, -24, 0, 40), Position = UDim2.new(0, 12, 0, 35),
        BackgroundTransparency = 1, Text = desc, TextColor3 = Color3.fromRGB(200, 200, 200),
        Font = Enum.Font.Gotham, TextSize = 13, TextXAlignment = 0, TextWrapped = true, TextYAlignment = 0
    })

    local timer = Create("Frame", {
        Parent = notif, Size = UDim2.new(1, 0, 0, 3), Position = UDim2.new(0, 0, 1, -3),
        BackgroundColor3 = self.ThemeColor, BorderSizePixel = 0
    })

    notif:TweenPosition(UDim2.new(1, -300, 1, -100), "Out", "Quart", 0.5)
    TweenService:Create(timer, TweenInfo.new(duration or 3, Enum.EasingStyle.Linear), {Size = UDim2.new(0,0,0,3)}):Play()
    
    task.delay(duration or 3, function()
        notif:TweenPosition(UDim2.new(1, 300, 1, -100), "In", "Quart", 0.5)
        task.wait(0.5) notif:Destroy()
    end)
end

--========================================================--
--                  MAIN WINDOW INIT
--========================================================--
function ToriH.new(options)
    local self = setmetatable({}, ToriH)
    self.Title = options.Title or "TORIH HUB"
    self.Author = options.Author or "NGUYỄN TRỌNG AN"
    self.ThemeColor = options.ThemeColor or Color3.fromRGB(0, 255, 127)
    self.Tabs = {}
    self.RGB = false
    self.Keybind = Enum.KeyCode.RightControl

    -- Intro
    task.spawn(function()
        local introGui = Create("ScreenGui", {Parent = CoreGui})
        local blur = Create("BlurEffect", {Parent = game:GetService("Lighting"), Size = 0})
        local bg = Create("Frame", {Parent = introGui, Size = UDim2.new(1,0,1,0), BackgroundColor3 = Color3.new(0,0,0), BackgroundTransparency = 1})
        local lbl = Create("TextLabel", {Parent = bg, Size = UDim2.new(1,0,1,0), BackgroundTransparency = 1, Text = "", TextColor3 = Color3.new(1,1,1), Font = 17, TextSize = 38})
        
        TweenService:Create(blur, TweenInfo.new(1), {Size = 20}):Play()
        TweenService:Create(bg, TweenInfo.new(1), {BackgroundTransparency = 0.2}):Play()
        local txt = self.Title .. "\nBY " .. self.Author
        for i = 1, #txt do lbl.Text = string.sub(txt, 1, i) task.wait(0.04) end
        task.wait(1.5)
        TweenService:Create(blur, TweenInfo.new(1), {Size = 0}):Play()
        local t = TweenService:Create(bg, TweenInfo.new(1), {BackgroundTransparency = 1})
        t:Play() t.Completed:Wait() introGui:Destroy() blur:Destroy()
    end)

    self.Gui = Create("ScreenGui", {Parent = CoreGui, Name = "ToriH_Titan"})
    
    local main = Create("Frame", {
        Parent = self.Gui, Size = UDim2.new(0, 620, 0, 420), Position = UDim2.new(0.5, -310, 0.5, -210),
        BackgroundColor3 = Color3.fromRGB(12, 12, 12), BorderSizePixel = 0, ClipsDescendants = true
    })
    self.Main = main
    Create("UICorner", {Parent = main, CornerRadius = UDim.new(0, 10)})
    local stroke = Create("UIStroke", {Parent = main, Color = self.ThemeColor, Thickness = 2})

    local side = Create("Frame", {
        Parent = main, Size = UDim2.new(0, 180, 1, 0), BackgroundColor3 = Color3.fromRGB(18, 18, 18)
    })
    Create("UICorner", {Parent = side, CornerRadius = UDim.new(0, 10)})
    
    local titleLbl = Create("TextLabel", {
        Parent = side, Size = UDim2.new(1, 0, 0, 50), Position = UDim2.new(0, 0, 0, 10),
        BackgroundTransparency = 1, Text = self.Title, TextColor3 = self.ThemeColor,
        Font = Enum.Font.GothamBold, TextSize = 20
    })

    local scroll = Create("ScrollingFrame", {
        Parent = side, Size = UDim2.new(1, 0, 1, -70), Position = UDim2.new(0, 0, 0, 60),
        BackgroundTransparency = 1, BorderSizePixel = 0, ScrollBarThickness = 0
    })
    Create("UIListLayout", {Parent = scroll, Padding = UDim.new(0, 5), HorizontalAlignment = 1})
    self.TabList = scroll

    self.Container = Create("Frame", {
        Parent = main, Size = UDim2.new(1, -190, 1, -20), Position = UDim2.new(0, 185, 0, 10),
        BackgroundTransparency = 1
    })

    -- RGB Logic
    RunService.RenderStepped:Connect(function()
        if self.RGB then
            stroke.Color = Color3.fromHSV(tick() % 5 / 5, 0.8, 1)
        else
            stroke.Color = self.ThemeColor
        end
    end)

    -- Keybind Toggle
    UserInputService.InputBegan:Connect(function(input, gpe)
        if not gpe and input.KeyCode == self.Keybind then
            main.Visible = not main.Visible
        end
    end)

    MakeDraggable(main, side)
    return self
end

--========================================================--
--                  ELEMENT CREATION
--========================================================--
function ToriH:CreateTab(name)
    local tab = {Name = name, Elements = {}}
    
    local btn = Create("TextButton", {
        Parent = self.TabList, Size = UDim2.new(0, 160, 0, 40),
        BackgroundColor3 = Color3.fromRGB(25, 25, 25), Text = "   " .. name,
        TextColor3 = Color3.fromRGB(200, 200, 200), Font = Enum.Font.GothamBold,
        TextSize = 13, TextXAlignment = 0, AutoButtonColor = false
    })
    Create("UICorner", {Parent = btn})
    
    local page = Create("ScrollingFrame", {
        Parent = self.Container, Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1, BorderSizePixel = 0, ScrollBarThickness = 2,
        ScrollBarImageColor3 = self.ThemeColor, Visible = false
    })
    Create("UIListLayout", {Parent = page, Padding = UDim.new(0, 8)})
    
    btn.MouseButton1Click:Connect(function()
        Ripple(btn)
        for _, t in pairs(self.Tabs) do
            t.Page.Visible = false
            TweenService:Create(t.Btn, T_Info, {BackgroundColor3 = Color3.fromRGB(25, 25, 25), TextColor3 = Color3.fromRGB(200, 200, 200)}):Play()
        end
        page.Visible = true
        TweenService:Create(btn, T_Info, {BackgroundColor3 = self.ThemeColor, TextColor3 = Color3.fromRGB(15, 15, 15)}):Play()
    end)

    tab.Btn = btn
    tab.Page = page
    table.insert(self.Tabs, tab)
    
    if #self.Tabs == 1 then
        page.Visible = true
        btn.BackgroundColor3 = self.ThemeColor
        btn.TextColor3 = Color3.fromRGB(15, 15, 15)
    end
    
    return tab
end

-- SECTION (Của Rayfield/Orion)
function ToriH:AddSection(tab, text)
    local sec = Create("Frame", {
        Parent = tab.Page, Size = UDim2.new(1, -10, 0, 30), BackgroundTransparency = 1
    })
    local l = Create("TextLabel", {
        Parent = sec, Size = UDim2.new(1, 0, 1, 0), BackgroundTransparency = 1,
        Text = text:upper(), TextColor3 = self.ThemeColor, Font = Enum.Font.GothamBold,
        TextSize = 12, TextXAlignment = 0
    })
    return sec
end

-- BUTTON
function ToriH:AddButton(tab, text, callback)
    local btn = Create("TextButton", {
        Parent = tab.Page, Size = UDim2.new(1, -10, 0, 40),
        BackgroundColor3 = Color3.fromRGB(22, 22, 22), Text = "   " .. text,
        TextColor3 = Color3.new(1, 1, 1), Font = Enum.Font.GothamSemibold,
        TextSize = 14, TextXAlignment = 0, AutoButtonColor = false
    })
    Create("UICorner", {Parent = btn})
    local icon = Create("TextLabel", {
        Parent = btn, Size = UDim2.new(0, 30, 1, 0), Position = UDim2.new(1, -35, 0, 0),
        BackgroundTransparency = 1, Text = ">", TextColor3 = Color3.fromRGB(100, 100, 100),
        Font = Enum.Font.GothamBold, TextSize = 14
    })
    
    btn.MouseButton1Click:Connect(function()
        Ripple(btn)
        callback()
    end)
end

-- TOGGLE
function ToriH:AddToggle(tab, text, def, callback)
    local frame = Create("Frame", {
        Parent = tab.Page, Size = UDim2.new(1, -10, 0, 45), BackgroundColor3 = Color3.fromRGB(22, 22, 22)
    })
    Create("UICorner", {Parent = frame})
    local l = Create("TextLabel", {
        Parent = frame, Size = UDim2.new(1, -60, 1, 0), Position = UDim2.new(0, 15, 0, 0),
        BackgroundTransparency = 1, Text = text, TextColor3 = Color3.new(1,1,1),
        Font = Enum.Font.Gotham, TextSize = 14, TextXAlignment = 0
    })
    local tog = Create("TextButton", {
        Parent = frame, Size = UDim2.new(0, 44, 0, 22), Position = UDim2.new(1, -55, 0.5, -11),
        BackgroundColor3 = def and self.ThemeColor or Color3.fromRGB(50, 50, 50), Text = ""
    })
    Create("UICorner", {Parent = tog, CornerRadius = UDim.new(1, 0)})
    local circ = Create("Frame", {
        Parent = tog, Size = UDim2.new(0, 18, 0, 18), Position = def and UDim2.new(1, -21, 0.5, -9) or UDim2.new(0, 3, 0.5, -9),
        BackgroundColor3 = Color3.new(1,1,1)
    })
    Create("UICorner", {Parent = circ, CornerRadius = UDim.new(1, 0)})

    local s = def
    tog.MouseButton1Click:Connect(function()
        s = not s
        TweenService:Create(tog, T_Info, {BackgroundColor3 = s and self.ThemeColor or Color3.fromRGB(50, 50, 50)}):Play()
        circ:TweenPosition(s and UDim2.new(1, -21, 0.5, -9) or UDim2.new(0, 3, 0.5, -9), "Out", "Quart", 0.3)
        callback(s)
    end)
end

-- SLIDER (RenderStepped Mượt)
function ToriH:AddSlider(tab, text, min, max, def, callback)
    local frame = Create("Frame", {
        Parent = tab.Page, Size = UDim2.new(1, -10, 0, 65), BackgroundColor3 = Color3.fromRGB(22, 22, 22)
    })
    Create("UICorner", {Parent = frame})
    local l = Create("TextLabel", {
        Parent = frame, Size = UDim2.new(1, -20, 0, 30), Position = UDim2.new(0, 15, 0, 5),
        BackgroundTransparency = 1, Text = text, TextColor3 = Color3.new(1,1,1),
        Font = Enum.Font.Gotham, TextSize = 14, TextXAlignment = 0
    })
    local valLbl = Create("TextLabel", {
        Parent = frame, Size = UDim2.new(0, 50, 0, 30), Position = UDim2.new(1, -65, 0, 5),
        BackgroundTransparency = 1, Text = tostring(def), TextColor3 = self.ThemeColor,
        Font = Enum.Font.GothamBold, TextSize = 14, TextXAlignment = 2
    })
    local bar = Create("Frame", {
        Parent = frame, Size = UDim2.new(1, -30, 0, 6), Position = UDim2.new(0, 15, 0, 45),
        BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    })
    Create("UICorner", {Parent = bar})
    local fill = Create("Frame", {
        Parent = bar, Size = UDim2.new((def-min)/(max-min), 0, 1, 0), BackgroundColor3 = self.ThemeColor
    })
    Create("UICorner", {Parent = fill})

    local drag = false
    local function upd()
        local p = math.clamp((Mouse.X - bar.AbsolutePosition.X) / bar.AbsoluteSize.X, 0, 1)
        local v = math.floor(min + (max - min) * p)
        fill.Size = UDim2.new(p, 0, 1, 0)
        valLbl.Text = tostring(v)
        callback(v)
    end
    bar.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then drag = true upd() end end)
    UserInputService.InputChanged:Connect(function(i) if drag and i.UserInputType == Enum.UserInputType.MouseMovement then upd() end end)
    UserInputService.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 then drag = false end end)
end

-- COLOR PICKER (Hệ thống màu nâng cao)
function ToriH:AddColorPicker(tab, text, def, callback)
    local frame = Create("Frame", {
        Parent = tab.Page, Size = UDim2.new(1, -10, 0, 45), BackgroundColor3 = Color3.fromRGB(22, 22, 22)
    })
    Create("UICorner", {Parent = frame})
    local l = Create("TextLabel", {Parent = frame, Size = UDim2.new(1, 0, 1, 0), Position = UDim2.new(0, 15, 0, 0), BackgroundTransparency = 1, Text = text, TextColor3 = Color3.new(1,1,1), Font = 17, TextSize = 14, TextXAlignment = 0})
    
    local view = Create("TextButton", {
        Parent = frame, Size = UDim2.new(0, 40, 0, 22), Position = UDim2.new(1, -50, 0.5, -11),
        BackgroundColor3 = def, Text = ""
    })
    Create("UICorner", {Parent = view})

    view.MouseButton1Click:Connect(function()
        -- Logic đơn giản: Đổi qua các màu chủ đạo (Bạn có thể thêm bảng màu GUI ở đây)
        local colors = {Color3.new(1,0,0), Color3.new(0,1,0), Color3.new(0,0,1), Color3.new(1,1,0), Color3.new(1,1,1)}
        local nextC = colors[math.random(1, #colors)]
        view.BackgroundColor3 = nextC
        callback(nextC)
    end)
end

-- KEYBIND
function ToriH:AddKeybind(tab, text, def, callback)
    local frame = Create("Frame", {
        Parent = tab.Page, Size = UDim2.new(1, -10, 0, 45), BackgroundColor3 = Color3.fromRGB(22, 22, 22)
    })
    Create("UICorner", {Parent = frame})
    local l = Create("TextLabel", {Parent = frame, Size = UDim2.new(1, 0, 1, 0), Position = UDim2.new(0, 15, 0, 0), BackgroundTransparency = 1, Text = text, TextColor3 = Color3.new(1,1,1), Font = 17, TextSize = 14, TextXAlignment = 0})
    
    local currKey = def.Name
    local btn = Create("TextButton", {
        Parent = frame, Size = UDim2.new(0, 80, 0, 25), Position = UDim2.new(1, -90, 0.5, -12),
        BackgroundColor3 = Color3.fromRGB(35, 35, 35), Text = currKey, TextColor3 = self.ThemeColor, Font = 17, TextSize = 13
    })
    Create("UICorner", {Parent = btn})

    btn.MouseButton1Click:Connect(function()
        btn.Text = "..."
        local connection
        connection = UserInputService.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.Keyboard then
                btn.Text = input.KeyCode.Name
                callback(input.KeyCode)
                connection:Disconnect()
            end
        end)
    end)
end

-- DROPDOWN (Mượt và tự động điều chỉnh)
function ToriH:AddDropdown(tab, text, list, callback)
    local drop = Create("Frame", {
        Parent = tab.Page, Size = UDim2.new(1, -10, 0, 45), BackgroundColor3 = Color3.fromRGB(22, 22, 22),
        ClipsDescendants = true
    })
    Create("UICorner", {Parent = drop})
    local btn = Create("TextButton", {
        Parent = drop, Size = UDim2.new(1, 0, 0, 45), BackgroundTransparency = 1,
        Text = "   " .. text .. " : Select...", TextColor3 = Color3.new(1,1,1), Font = 17, TextSize = 14, TextXAlignment = 0
    })
    local container = Create("Frame", {
        Parent = drop, Size = UDim2.new(1, 0, 0, #list * 35), Position = UDim2.new(0,0,0,45), BackgroundTransparency = 1
    })
    Create("UIListLayout", {Parent = container})

    local isDown = false
    btn.MouseButton1Click:Connect(function()
        isDown = not isDown
        drop:TweenSize(isDown and UDim2.new(1,-10,0, 45 + (#list * 35)) or UDim2.new(1,-10,0,45), "Out", "Quart", 0.4)
    end)

    for _, v in pairs(list) do
        local opt = Create("TextButton", {
            Parent = container, Size = UDim2.new(1, 0, 0, 35), BackgroundColor3 = Color3.fromRGB(30, 30, 30),
            Text = tostring(v), TextColor3 = Color3.fromRGB(180, 180, 180), Font = 17, TextSize = 13, BorderSizePixel = 0
        })
        opt.MouseButton1Click:Connect(function()
            btn.Text = "   " .. text .. " : " .. tostring(v)
            isDown = false
            drop:TweenSize(UDim2.new(1,-10,0,45), "Out", "Quart", 0.4)
            callback(v)
        end)
    end
end

--========================================================--
--                  CORE SETTINGS
--========================================================--
function ToriH:CreateSettingsTab()
    local s = self:CreateTab("Settings")
    self:AddSection(s, "Interface Settings")
    self:AddToggle(s, "Rainbow UI Border", false, function(v) self.RGB = v end)
    self:AddKeybind(s, "Close UI Key", Enum.KeyCode.RightControl, function(k) self.Keybind = k end)
    
    self:AddSection(s, "Themes")
    self:AddButton(s, "Theme: Neon Green", function() self.ThemeColor = self.Themes.Default end)
    self:AddButton(s, "Theme: Ruby Red", function() self.ThemeColor = self.Themes.Ruby end)
    self:AddButton(s, "Theme: Ocean Blue", function() self.ThemeColor = self.Themes.Ocean end)
    
    self:AddSection(s, "System")
    self:AddButton(s, "Unload Script", function() self.Gui:Destroy() end)
    self:AddButton(s, "Copy Discord Link", function() setclipboard("discord.gg/torihub") end)
end

return ToriH
